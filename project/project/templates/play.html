<!DOCTYPE html>
<html lang="en">
<head>
    {% block title %}<title>Local Library</title>{% endblock %}
        <!-- development version, includes helpful console warnings -->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- axios is a communication platform for vue to communicate to backend-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/global_css_classes.css' %}">
    <style>
        #play-area{
            display: flex;
            height: 100vh;
            width: 100%;
        }
        #main-area{
            display: flex;
            flex-direction: column;
            flex:7;
            height: 100%;

        }
        #options-area{
            flex: 2;
            height: 100%;
            background-color: green;
        }
        #board-area{
            display: flex;
            flex: 8;
        }
        #hand-area{
            display: flex;
            padding: 10px;
            justify-content: space-around;
            flex: 3;
            background-color: brown;
        }
        .side-bar,#top-bar{
            background-color: burlywood;
            flex:1.5;
        }
        #board-grid-area{
            background-color: aqua;
            flex:9;
            display: grid;
            padding: 10px;
        }
        #test_deck{
            width: 71px;
            height: 97px;
        }
        .selected{
            border:5px solid red;
            margin: 0px;
        }
    </style>
</head>
<body>
<script>
        //preload cards into js with django. we can make this dynamic later with vue
        let players = {{players | safe}};
        let player = {{player | safe}};
        let selected = [];
        let play_area_vue;
        window.onload = function () {
            //vue setup. delimeters set to square brackets because django uses curly
            play_area_vue = new Vue({
                delimiters: ['[[', ']]'],
                el: '#play-area',
                data: {
                    players: players,
                    player: player,
                    selected:selected
                },
                computed:{
                  middle_players(){
                        if(players.length>2) {
                            return players.splice(1, players.length - 2);
                        }
                  },
                  right_player(){
                      if(players.length>1){
                          return players[players.length-1];
                      }

                  },
                  left_player(){
                      if(players.length>0){
                          return players[0];
                      }
                  }
                },
                methods: {
                    toggle_selection: function (card_uid) {
                        if(selected.indexOf(card_uid)>=0){
                            selected.splice(selected.indexOf(card_uid),1);
                        }
                        else{
                            selected.push(card_uid);
                        }
                    }
                }
            });
        }
</script>
  {% block sidebar %}<!-- insert default navigation text for every page -->{% endblock %}
  {% block content %}
    <div id="play-area">
        <div id="main-area">
            <div id="top-bar">
                <div v-for="player in middle_players" class="player" :data-player-uid="player.player_uid">[[player]]</div>
            </div>
            <div id="board-area">
                <div id="left-bar" class="side-bar">
                     <div class="player" :data-player-uid="left_player.player_uid">[[ left_player ]]</div>
                </div>
                <div id="board-grid-area">
                    <button id ="test_deck" onclick="testAxios(this)"> Style me Please</button>
                        <!-- Juan TODO: put in button here that triggers axios call to utils play card thing that passes player.playeruid, deckuid (may have to into play render function and pull deck related to room) -->
                </div>
                <div id="right-bar" class="side-bar">
                    <div class="player" :data-player-uid="right_player.player_uid">[[ right_player ]]</div>
                </div>
            </div>
            <div id="hand-area">
                <template v-for="card in player.hand">
                    <div v-if="selected.includes(card.card_uid)" :class="'card selected ' + card.media_class" @click="toggle_selection(card.card_uid)">

                    </div>
                    <div v-else :class="'card '+card.media_class" @click="toggle_selection(card.card_uid)">

                    </div>
                </template>
            </div>
        </div>
        <div id="options-area">

        </div>


    </div>

  {% endblock %}
  <script>
    function testAxios(btn) {
        btn.style.color="red";
        console.log('Test button');
        axios.get("/api/5").then((response) => {
            btn.innerHTML = response.data;
        });
    }
  </script>
</body>
</html>