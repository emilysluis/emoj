<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v4.0.1">
    <title>Emoj * Game Play</title>
    <link href="../static/css/bootstrap.css" rel="stylesheet">


    {#    {% block title %}<title>Local Library</title>{% endblock %}#}
    {#        <!-- development version, includes helpful console warnings -->#}
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <!-- axios is a communication platform for vue to communicate to backend-->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        {% load static %}
        <link rel="stylesheet" type="text/css" href="{% static 'css/global_css_classes.css' %}">
{#        <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.css.css' %}">#}

    <style>
        #container{
            height: calc(100vh - 80px);
            width: calc(100% - 20px);
        }
        #play-area {
            display: flex;
            height: 100%;
            width: 100%;
        }

        #main-area {
            display: flex;
            flex-direction: column;
            flex: 7;
            height: 100%;
        }

        #options-area {
            flex: 2;
            height: 100%;
            background-color: green;
        }

        #board-area {
            display: flex;
            flex: 8;
        }

        #hand-area .card-body{
            display: flex;
            justify-content: space-around;
        }

        .side-bar, #top-bar {
            flex: 1.5;
        }


        #board-grid-area {
            flex: 9;
            display: grid;
            padding: 10px;
        }
        #test_deck{
            width: 71px;
            height: 97px;
        }
        .selected{
            border:5px solid red;
            margin: 0px !important;
            box-sizing: content-box;
        }
        .player{
            flex-grow:1;
            max-width: 150px;
            margin:4px ;
        }

        .blog-header {
            line-height: 1;
            border-bottom: 1px solid #e5e5e5;
        }

        .blog-header-logo {
            font-family: "Playfair Display", Georgia, "Times New Roman", serif;
            font-size: 2.25rem;
        }

        .blog-header-logo:hover {
            text-decoration: none;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: "Playfair Display", Georgia, "Times New Roman", serif;
        }

    </style>
</head>
<body>
<script>
        //preload cards into js with django. we can make this dynamic later with vue
        let players = {{players | safe}};
        let player = {{player | safe}};
        let selected = {"players":[], "locations":[], "cards":[]};
        let play_area_vue;
        window.onload = function () {
            //vue setup. delimeters set to square brackets because django uses curly
            play_area_vue = new Vue({
                delimiters: ['[[', ']]'],
                el: '#play-area',
                data: {
                    players: players,
                    player: player,
                    selected:selected
                },
                computed:{
                  middle_players:function(){
                        if(players.length>2) {
                            return players.splice(1, players.length - 2);
                        }
                  },
                  right_player:function(){
                      if(players.length>1){
                          return players[players.length-1];
                      }
                  },
                  left_player:function(){
                      if(players.length>0){
                          return players[0];
                      }
                  }
                },
                methods: {
                    toggle_card_selection: function (card_uid) {
                        if(selected.cards.indexOf(card_uid)>=0){
                            selected.cards.splice(selected.cards.indexOf(card_uid),1);
                        }
                        else{
                            selected.cards.push(card_uid);
                        }
                    },
                    toggle_player_selection: function(player_uid) {
                        if(selected.players.indexOf(player_uid)>=0){
                            selected.players.splice(selected.players.indexOf(player_uid),1);
                        }
                        else{
                            selected.players.push(player_uid);
                        }
                    }
                }
            });
        }
</script>
{#{% block sidebar %}<!-- insert default navigation text for every page -->{% endblock %}#}

{% block content %}

    <div id="container">
        <header class="blog-header py-3">
            <div class="row flex-nowrap justify-content-between align-items-center">
                <div class="col-4 pt-1">
                    <a class="text-muted" href="#">Home</a>
                </div>
                <div class="col-4 text-center">
                    <a class="blog-header-logo text-dark" href="#">Play</a>
                </div>
                <div class="col-4 d-flex justify-content-end align-items-center"></div>
            </div>
        </header>

        <div id="play-area" style="padding-top: 15px;">
            <div id="main-area">
                <div id="top-bar" style="display: flex; justify-content: space-around">
                    <div v-for="player in middle_players"  class="player card text-white bg-info" v-bind:class="{ selected: selected.players.includes(player.player_uid) }" @click="toggle_player_selection(player.player_uid)">
                        <small class="card-header">Opponent: [[player.display_name]]</small>
                        <div class="card-body" style="white-space:normal">
                            <small>Details</small>
                            {# <small v-for="(value, name) in player" style="white-space: normal">[[name]]: [[value]]</small>#}
                        </div>
                    </div>
                </div>
                <div id="board-area">
                    <div id="left-bar" class="side-bar">
                        <div class="player card text-white bg-info"  v-bind:class="{ selected: selected.players.includes(left_player.player_uid) }" @click="toggle_player_selection(left_player.player_uid)">
                        <small class="card-header">Opponent: [[left_player.display_name]]</small>
                        <div class="card-body" style="white-space:normal">
                            <small>Details</small>
                            <small>left player</small>
                        </div>
                    </div>

                    </div>
                    <div id="board-grid-area" class="card text-white bg-secondary">
                        <button id ="test_deck" onclick="testAxios(this)"> Style me Please</button>
                    </div>
                    <div id="right-bar" class="side-bar">
                        <div class="player card text-white bg-info mb-3"  v-bind:class="{ selected: selected.players.includes(right_player.player_uid) }" @click="toggle_player_selection(right_player.player_uid)" >
                        <small class="card-header">Opponent: [[right_player.display_name]]</small>
                        <div class="card-body" style="white-space:normal">
                            <small>Details</small>
                            <small>right player</small>
                        </div>
                    </div>
                    </div>
                </div>
                <div id="hand-area" class="card bg-danger text-white">
                    <div class="card-header">Hand</div>
                    <div class="card-body">
                        <template v-for="card in player.hand">
                    <div v-if="selected.cards.includes(card.card_uid)" :class="'playing-card selected ' + card.media_class" @click="toggle_card_selection(card.card_uid)">

                    </div>
                    <div v-else :class="'playing-card '+card.media_class" @click="toggle_card_selection(card.card_uid)">

                    </div>
                </template>
                    </div>
                </div>
            </div>
            <div id="options-area" class="card text-white bg-success " style="min-width: 80px">
                <div class="card-header">Options</div>
            </div>
        </div>
    </div>
{% endblock %}
<script>

    function testAxios(btn) {
        btn.style.color="red";
        console.log('Test button');
        axios.defaults.xsrfCookieName = 'csrftoken'
        axios.defaults.xsrfHeaderName = "X-CSRFTOKEN"
        axios.post("/api/5").then((response) => {
            btn.innerHTML = response.data;
        });
    }
</script>
</body>
</html>
